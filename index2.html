<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no, width=device-width">
    <title>标注和标注图层-海量点</title>
    <link rel="stylesheet" href="https://a.amap.com/jsapi_demos/static/demo-center/css/demo-center.css"/>
    <style>
        html, body, #container {
            height: 100%;
            width: 100%;
            margin: 0;
        }
        .amap-info-window{
            width: 150px;
            background: #fff;
            border-radius: 3px;
            padding: 3px 7px;
            box-shadow: 0 2px 6px 0 rgba(114, 124, 245, .5);
            position: relative;
        }
        .amap-info-sharp{
            position: absolute;
            top: 21px;
            bottom: 0;
            left: 50%;
            margin-left: -8px;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-top: 8px solid #fff;
        }
    </style>
</head>
<body>
<div id="container"></div>

<div class="info">
    海量点展示
    <!-- : 30000 -->
 </div>
<script type="text/javascript"
        src="https://webapi.amap.com/maps?v=1.4.15&key=d8130f865a429d49a79d44397c77c4ff"></script>
<!-- <script type="text/javascript" src="https://a.amap.com/jsapi_demos/static/demo-center/data/mock_position.js"></script> -->

<script type="text/javascript">
    var map = new AMap.Map('container', {
        zoom: 9,
        viewMode:'3D',
        center: [116.441, 40.031],
        mapStyle: 'amap://styles/whitesmoke',
        showLabel: false,
        showIndoorMap: false,
    });

    map.on('complete', function () {
        // 创建 AMap.LabelsLayer 图层
        var layer = new AMap.LabelsLayer({
            zooms: [3, 20],
            zIndex: 1000,
            collision: false
        });

        // 将图层添加到地图
        map.add(layer);

        var markers = [];
        // var positions = Positions.slice(0, 3E4);
        // var positions = [["116.441504","40.031386"],["116.466426","39.971294"],["116.443838","39.723097"],]
        var positions = [["116.441504","40.031386"],["116.466426","39.971294"],["116.443838","39.723097"],["116.470679","40.020576"],["116.522323","40.042006"],["116.395659","39.797351"],["116.118438","39.788421"],["116.306554","40.051124"],["116.410109","39.863089"],["116.237956","39.856638"],["116.414847","39.872101"],["116.378096","39.862151"],["116.374007","39.907619"],["116.264677","39.906542"],["116.374771","40.10086"],["116.689728","40.019175"],["116.374144","39.883654"],["116.365874","39.987327"],["116.58219","39.751092"],["116.684996","40.327258"],["116.477973","39.987746"],["116.451918","39.982646"],["116.40565","39.962105"],["116.348723","39.986815"],["116.447178","39.859231"],["116.3151","39.886732"],["116.181355","39.817032"],["116.353724","39.588081"],["116.256804","40.086322"],["116.322173","39.70021"],["116.554809","40.025499"],["116.598014","39.838229"],["116.573416","39.810885"],["116.69804","40.039724"],["116.384261","39.987597"],["116.435344","39.746919"],["116.812613","39.802763"],["116.093184","39.719226"],["116.727769","39.639731"],["116.345042","39.822802"],["116.634148","40.312279"],["116.624649","40.044904"],["116.351605","40.003057"],["116.542465","40.070977"],["116.265349","40.235543"],["116.335217","39.770789"],["116.264057","40.138553"],["116.369607","39.981576"],["116.527168","39.767207"],["116.257045","40.1723"],["116.57598","40.035914"],["116.470221","39.97098"],["116.205075","39.761149"],["116.449337","40.207716"],["116.478758","39.591689"],["116.220759","39.765049"],["116.529464","39.94152"],["116.48931","39.880713"],["116.269726","39.86512"],["116.230261","39.897086"],["116.46339","39.975531"],["116.92884","39.800036"],["116.217101","39.958937"],["116.692061","39.870722"],["117.15793","40.189296"],["116.274792","40.188887"],["116.318572","39.78081"],["116.261259","40.143122"],["116.389197","39.987799"],["116.680538","39.874466"],["116.353972","39.98202"],["116.684324","39.894222"],["116.58546","39.826524"],["116.560834","39.759204"],["116.433577","39.943473"],["116.706055","40.061837"],["116.644736","40.296694"],["116.56208","39.791663"],["116.350279","40.220236"],["115.983669","39.689887"],["116.389583","39.935342"],["116.563175","39.796367"],["116.320525","39.985934"],["116.372177","39.947518"],["116.489565","39.94943"],["116.719988","40.328348"],["116.344611","39.967688"],["116.359015","39.944372"],["116.310063","39.924857"],["116.363182","39.869083"],["116.486629","39.989871"],["116.693305","40.348384"],["116.292382","39.888202"],["116.406172","39.926451"],["116.398261","39.949038"],["115.995017","39.69089"],["116.070487","40.29481"],["116.366271","39.940604"],["116.105978","39.683898"],["116.334151","40.022711"],["116.399299","39.948962"],["116.489523","39.925258"],["116.730215","39.798705"],["116.211386","39.863768"],["116.006278","39.672016"],["116.455901","39.907957"],["116.820263","39.657468"],["116.488897","39.832361"],["116.615455","40.053451"],["116.30345","39.881816"],["116.614442","40.05063"],["116.510318","40.149762"],["116.735609","40.819137"],["116.709101","39.879833"],["116.489696","39.976892"],["116.373081","40.001584"],["116.456832","39.884436"],["116.413841","40.057549"],["116.693869","39.916221"],["116.377196","40.077906"],["116.426284","39.871295"],["116.455445","39.875404"],["116.648594","40.117669"],["116.335387","39.955786"],["116.273803","39.943484"],["116.638818","40.308641"],["116.516244","40.120611"],["116.353441","39.701252"],["116.613678","40.053277"],["116.450316","39.920947"],["116.698897","39.859916"],["116.663672","39.908289"],["116.208753","39.896693"],["116.478933","39.842562"],["116.297328","39.828882"],["116.456443","39.959506"],["116.641219","40.165221"],["116.589474","40.077616"],["116.56951","39.916251"],["116.282897","39.859343"],["116.56078","40.063613"],["117.131713","40.138519"],["116.001475","40.453194"],["116.465558","39.933884"],["116.222373","40.211597"],["116.421451","39.871509"],["116.509758","39.870642"],["116.333313","39.897215"],["116.612616","40.043526"],["116.676627","39.975352"],["116.325512","39.621046"],["116.997181","40.169651"],["116.139509","39.858046"],["116.521278","39.75466"],["116.263243","39.863854"],["116.502677","39.742374"],["116.700709","39.790966"],["116.666953","40.028815"],["116.225208","39.845646"],["116.572745","39.893339"],["116.54934","39.971913"],["116.500273","39.871947"],["116.488455","39.988326"],["116.280413","39.541378"],["116.116707","39.928758"],["116.374198","39.864478"],["116.376544","39.949787"],["116.129953","39.744255"],["116.372313","39.98684"],["116.221252","40.21479"],["116.603804","39.760375"],["116.43859","39.907076"],["116.417944","39.965823"],["116.373374","39.90705"],["116.495902","39.962428"],["116.46883","39.829551"],["116.560218","39.772437"],["116.636641","39.905833"],["116.654149","39.79758"],["116.34631","39.889726"],["116.637496","40.165923"],["116.421531","40.022139"],["116.534713","40.01367"],["116.541251","39.91136"],["116.45758","39.97898"],["116.227798","39.945835"],["116.841384","39.857215"],["116.5896","40.018887"],["116.54859","39.872184"],["116.417053","39.924533"],["116.518092","39.977995"],["116.65692","39.911898"],["116.434136","39.93204"],["116.355828","39.93364"],["116.66368","39.743589"],["116.511767","40.009728"],["116.287704","40.108291"]]

        var icon = {
            type: 'image',
            image: 'https://webapi.amap.com/theme/v1.3/markers/n/mark_b.png',
            size: [6, 9],
            anchor: 'bottom-center',
        };

        for (var i = 0; i < positions.length; i++) {
            var curPosition = positions[i];
            var curData = {
                position: curPosition,
                icon
            };

            var labelMarker = new AMap.LabelMarker(curData);

            markers.push(labelMarker);

            // 给marker绑定事件
            labelMarker.on('mouseover', function(e){
                var position = e.data.data && e.data.data.position;

                if(position){
                    normalMarker.setContent(
                        '<div class="amap-info-window">'
                            + position +
                            '<div class="amap-info-sharp"></div>' +
                        '</div>');
                    normalMarker.setPosition(position);
                    map.add(normalMarker);
                }
            });

            labelMarker.on('mouseout', function(){
                map.remove(normalMarker);
            });
        }

        // 一次性将海量点添加到图层
        layer.add(markers);

        // 普通点
        var normalMarker = new AMap.Marker({
            anchor: 'bottom-center',
            offset: [0, -15],
        });
    });
</script>
</body>
</html>